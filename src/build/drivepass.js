(function(){function t(t,e,n){for(var r=(n||0)-1,i=t?t.length:0;++r<i;)if(t[r]===e)return r;return-1}function e(t,e){for(var n=t.criteria,r=e.criteria,i=-1,s=n.length;++i<s;){var o=n[i],a=r[i];if(o!==a){if(o>a||"undefined"==typeof o)return 1;if(a>o||"undefined"==typeof a)return-1}}return t.index-e.index}function n(t){return"\\"+wn[t]}function r(t,e,n){e||(e=0),"undefined"==typeof n&&(n=t?t.length:0);for(var r=-1,i=n-e||0,s=Array(0>i?0:i);++r<i;)s[r]=t[e+r];return s}function i(t){return t instanceof i?t:new s(t)}function s(t,e){this.__chain__=!!e,this.__wrapped__=t}function o(t){function e(){if(i){var t=r(i);kn.apply(t,arguments)}if(this instanceof e){var o=a(n.prototype),u=n.apply(o,t||arguments);return Y(u)?u:o}return n.apply(s,t||arguments)}var n=t[0],i=t[2],s=t[4];return e}function a(t){return Y(t)?Rn(t):{}}function u(t,e,n){if("function"!=typeof t)return Xe;if("undefined"==typeof e||!("prototype"in t))return t;switch(n){case 1:return function(n){return t.call(e,n)};case 2:return function(n,r){return t.call(e,n,r)};case 3:return function(n,r,i){return t.call(e,n,r,i)};case 4:return function(n,r,i,s){return t.call(e,n,r,i,s)}}return De(t,e)}function c(t){function e(){var t=f?u:this;if(s){var v=r(s);kn.apply(v,arguments)}if((o||p)&&(v||(v=r(arguments)),o&&kn.apply(v,o),p&&v.length<l))return i|=16,c([n,d?i:-4&i,v,null,u,l]);if(v||(v=arguments),h&&(n=t[g]),this instanceof e){t=a(n.prototype);var m=n.apply(t,v);return Y(m)?m:t}return n.apply(t,v)}var n=t[0],i=t[1],s=t[2],o=t[3],u=t[4],l=t[5],f=1&i,h=2&i,p=4&i,d=8&i,g=n;return e}function l(t,e){for(var n=-1,r=y(),i=t?t.length:0,s=[];++n<i;){var o=t[n];r(e,o)<0&&s.push(o)}return s}function f(t,e,n,r){for(var i=(r||0)-1,s=t?t.length:0,o=[];++i<s;){var a=t[i];if(a&&"object"==typeof a&&"number"==typeof a.length&&(zn(a)||b(a))){e||(a=f(a,e,n));var u=-1,c=a.length,l=o.length;for(o.length+=c;++u<c;)o[l++]=a[u]}else n||o.push(a)}return o}function h(t,e,n,r){if(t===e)return 0!==t||1/t==1/e;var s=typeof t,o=typeof e;if(!(t!==t||t&&bn[s]||e&&bn[o]))return!1;if(null==t||null==e)return t===e;var a=Dn.call(t),u=Dn.call(e);if(a!=u)return!1;switch(a){case dn:case gn:return+t==+e;case mn:return t!=+t?e!=+e:0==t?1/t==1/e:t==+e;case _n:case Tn:return t==String(e)}var c=a==pn;if(!c){var l=t instanceof i,f=e instanceof i;if(l||f)return h(l?t.__wrapped__:t,f?e.__wrapped__:e,n,r);if(a!=yn)return!1;var p=t.constructor,d=e.constructor;if(p!=d&&!(B(p)&&p instanceof p&&B(d)&&d instanceof d)&&"constructor"in t&&"constructor"in e)return!1}n||(n=[]),r||(r=[]);for(var g=n.length;g--;)if(n[g]==t)return r[g]==e;var v=!0,m=0;if(n.push(t),r.push(e),c){if(m=e.length,v=m==t.length)for(;m--&&(v=h(t[m],e[m],n,r)););}else tr(e,function(e,i,s){return Yn.call(s,i)?(m++,!(v=Yn.call(t,i)&&h(t[i],e,n,r))&&an):void 0}),v&&tr(t,function(t,e,n){return Yn.call(n,e)?!(v=--m>-1)&&an:void 0});return n.pop(),r.pop(),v}function p(t,e){return t+Bn(Mn()*(e-t+1))}function d(t,e,n){for(var r=-1,i=y(),s=t?t.length:0,o=[],a=n?[]:o;++r<s;){var u=t[r],c=n?n(u,r,t):u;(e?!r||a[a.length-1]!==c:i(a,c)<0)&&(n&&a.push(c),o.push(u))}return o}function g(t){return function(e,n,r){var i={};n=Ue(n,r,3);var s=-1,o=e?e.length:0;if("number"==typeof o)for(;++s<o;){var a=e[s];t(i,a,n(a,s,e),e)}else er(e,function(e,r,s){t(i,e,n(e,r,s),s)});return i}}function v(t,e,n,r,i,s){var a=2&e,u=16&e,l=32&e;if(!a&&!B(t))throw new TypeError;u&&!n.length&&(e&=-17,u=n=!1),l&&!r.length&&(e&=-33,l=r=!1);var f=1==e||17===e?o:c;return f([t,e,n,r,i,s])}function m(t){return Vn[t]}function y(){var e=(e=i.indexOf)===me?t:e;return e}function _(t){return"function"==typeof t&&In.test(t)}function T(t){return Kn[t]}function b(t){return t&&"object"==typeof t&&"number"==typeof t.length&&Dn.call(t)==hn||!1}function w(t){if(!t)return t;for(var e=1,n=arguments.length;n>e;e++){var r=arguments[e];if(r)for(var i in r)t[i]=r[i]}return t}function x(t){return Y(t)?zn(t)?r(t):w({},t):t}function F(t){if(!t)return t;for(var e=1,n=arguments.length;n>e;e++){var r=arguments[e];if(r)for(var i in r)"undefined"==typeof t[i]&&(t[i]=r[i])}return t}function A(t){var e=[];return tr(t,function(t,n){B(t)&&e.push(n)}),e.sort()}function E(t,e){return t?Yn.call(t,e):!1}function S(t){for(var e=-1,n=Wn(t),r=n.length,i={};++e<r;){var s=n[e];i[t[s]]=s}return i}function P(t){return t===!0||t===!1||t&&"object"==typeof t&&Dn.call(t)==dn||!1}function O(t){return t&&"object"==typeof t&&Dn.call(t)==gn||!1}function j(t){return t&&1===t.nodeType||!1}function D(t){if(!t)return!0;if(zn(t)||$(t))return!t.length;for(var e in t)if(Yn.call(t,e))return!1;return!0}function I(t,e){return h(t,e)}function C(t){return $n(t)&&!qn(parseFloat(t))}function B(t){return"function"==typeof t}function Y(t){return!(!t||!bn[typeof t])}function k(t){return R(t)&&t!=+t}function N(t){return null===t}function R(t){return"number"==typeof t||t&&"object"==typeof t&&Dn.call(t)==mn||!1}function L(t){return t&&bn[typeof t]&&Dn.call(t)==_n||!1}function $(t){return"string"==typeof t||t&&"object"==typeof t&&Dn.call(t)==Tn||!1}function q(t){return"undefined"==typeof t}function U(t){var e=[];tr(t,function(t,n){e.push(n)}),e=l(e,f(arguments,!0,!1,1));for(var n=-1,r=e.length,i={};++n<r;){var s=e[n];i[s]=t[s]}return i}function H(t){for(var e=-1,n=Wn(t),r=n.length,i=Array(r);++e<r;){var s=n[e];i[e]=[s,t[s]]}return i}function X(t){for(var e=-1,n=f(arguments,!0,!1,1),r=n.length,i={};++e<r;){var s=n[e];s in t&&(i[s]=t[s])}return i}function M(t){for(var e=-1,n=Wn(t),r=n.length,i=Array(r);++e<r;)i[e]=t[n[e]];return i}function J(t,e){var n=y(),r=t?t.length:0,i=!1;return r&&"number"==typeof r?i=n(t,e)>-1:er(t,function(t){return(i=t===e)&&an}),i}function z(t,e,n){var r=!0;e=Ue(e,n,3);var i=-1,s=t?t.length:0;if("number"==typeof s)for(;++i<s&&(r=!!e(t[i],i,t)););else er(t,function(t,n,i){return!(r=!!e(t,n,i))&&an});return r}function G(t,e,n){var r=[];e=Ue(e,n,3);var i=-1,s=t?t.length:0;if("number"==typeof s)for(;++i<s;){var o=t[i];e(o,i,t)&&r.push(o)}else er(t,function(t,n,i){e(t,n,i)&&r.push(t)});return r}function W(t,e,n){e=Ue(e,n,3);var r=-1,i=t?t.length:0;if("number"!=typeof i){var s;return er(t,function(t,n,r){return e(t,n,r)?(s=t,an):void 0}),s}for(;++r<i;){var o=t[r];if(e(o,r,t))return o}}function V(t,e){return he(t,e,!0)}function K(t,e,n){var r=-1,i=t?t.length:0;if(e=e&&"undefined"==typeof n?e:u(e,n,3),"number"==typeof i)for(;++r<i&&e(t[r],r,t)!==an;);else er(t,e)}function Q(t,e){var n=t?t.length:0;if("number"==typeof n)for(;n--&&e(t[n],n,t)!==!1;);else{var r=Wn(t);n=r.length,er(t,function(t,i,s){return i=r?r[--n]:--n,e(s[i],i,s)===!1&&an})}}function Z(t,e){var n=r(arguments,2),i=-1,s="function"==typeof e,o=t?t.length:0,a=Array("number"==typeof o?o:0);return K(t,function(t){a[++i]=(s?e:t[e]).apply(t,n)}),a}function te(t,e,n){var r=-1,i=t?t.length:0;if(e=Ue(e,n,3),"number"==typeof i)for(var s=Array(i);++r<i;)s[r]=e(t[r],r,t);else s=[],er(t,function(t,n,i){s[++r]=e(t,n,i)});return s}function ee(t,e,n){var r=-1/0,i=r;"function"!=typeof e&&n&&n[e]===t&&(e=null);var s=-1,o=t?t.length:0;if(null==e&&"number"==typeof o)for(;++s<o;){var a=t[s];a>i&&(i=a)}else e=Ue(e,n,3),K(t,function(t,n,s){var o=e(t,n,s);o>r&&(r=o,i=t)});return i}function ne(t,e,n){var r=1/0,i=r;"function"!=typeof e&&n&&n[e]===t&&(e=null);var s=-1,o=t?t.length:0;if(null==e&&"number"==typeof o)for(;++s<o;){var a=t[s];i>a&&(i=a)}else e=Ue(e,n,3),K(t,function(t,n,s){var o=e(t,n,s);r>o&&(r=o,i=t)});return i}function re(t,e,n,r){if(!t)return n;var i=arguments.length<3;e=Ue(e,r,4);var s=-1,o=t.length;if("number"==typeof o)for(i&&(n=t[++s]);++s<o;)n=e(n,t[s],s,t);else er(t,function(t,r,s){n=i?(i=!1,t):e(n,t,r,s)});return n}function ie(t,e,n,r){var i=arguments.length<3;return e=Ue(e,r,4),Q(t,function(t,r,s){n=i?(i=!1,t):e(n,t,r,s)}),n}function se(t,e,n){return e=Ue(e,n,3),G(t,function(t,n,r){return!e(t,n,r)})}function oe(t,e,n){if(t&&"number"!=typeof t.length&&(t=M(t)),null==e||n)return t?t[p(0,t.length-1)]:sn;var r=ae(t);return r.length=Xn(Hn(0,e),r.length),r}function ae(t){var e=-1,n=t?t.length:0,r=Array("number"==typeof n?n:0);return K(t,function(t){var n=p(0,++e);r[e]=r[n],r[n]=t}),r}function ue(t){var e=t?t.length:0;return"number"==typeof e?e:Wn(t).length}function ce(t,e,n){var r;e=Ue(e,n,3);var i=-1,s=t?t.length:0;if("number"==typeof s)for(;++i<s&&!(r=e(t[i],i,t)););else er(t,function(t,n,i){return(r=e(t,n,i))&&an});return!!r}function le(t,n,r){var i=-1,s=t?t.length:0,o=Array("number"==typeof s?s:0);for(n=Ue(n,r,3),K(t,function(t,e,r){o[++i]={criteria:[n(t,e,r)],index:i,value:t}}),s=o.length,o.sort(e);s--;)o[s]=o[s].value;return o}function fe(t){return zn(t)?r(t):t&&"number"==typeof t.length?te(t):M(t)}function he(t,e,n){return n&&D(e)?sn:(n?W:G)(t,e)}function pe(t){for(var e=-1,n=t?t.length:0,r=[];++e<n;){var i=t[e];i&&r.push(i)}return r}function de(t){return l(t,f(arguments,!0,!0,1))}function ge(t,e,n){var i=0,s=t?t.length:0;if("number"!=typeof e&&null!=e){var o=-1;for(e=Ue(e,n,3);++o<s&&e(t[o],o,t);)i++}else if(i=e,null==i||n)return t?t[0]:sn;return r(t,0,Xn(Hn(0,i),s))}function ve(t,e){return f(t,e)}function me(e,n,r){if("number"==typeof r){var i=e?e.length:0;r=0>r?Hn(0,i+r):r||0}else if(r){var s=Fe(e,n);return e[s]===n?s:-1}return t(e,n,r)}function ye(t,e,n){var i=0,s=t?t.length:0;if("number"!=typeof e&&null!=e){var o=s;for(e=Ue(e,n,3);o--&&e(t[o],o,t);)i++}else i=null==e||n?1:e||i;return r(t,0,Xn(Hn(0,s-i),s))}function _e(){for(var t=[],e=-1,n=arguments.length;++e<n;){var r=arguments[e];(zn(r)||b(r))&&t.push(r)}var i=t[0],s=-1,o=y(),a=i?i.length:0,u=[];t:for(;++s<a;)if(r=i[s],o(u,r)<0){for(var e=n;--e;)if(o(t[e],r)<0)continue t;u.push(r)}return u}function Te(t,e,n){var i=0,s=t?t.length:0;if("number"!=typeof e&&null!=e){var o=s;for(e=Ue(e,n,3);o--&&e(t[o],o,t);)i++}else if(i=e,null==i||n)return t?t[s-1]:sn;return r(t,Hn(0,s-i))}function be(t,e,n){var r=t?t.length:0;for("number"==typeof n&&(r=(0>n?Hn(0,r+n):Xn(n,r-1))+1);r--;)if(t[r]===e)return r;return-1}function we(t,e,n){t=+t||0,n=+n||1,null==e&&(e=t,t=0);for(var r=-1,i=Hn(0,Cn((e-t)/n)),s=Array(i);++r<i;)s[r]=t,t+=n;return s}function xe(t,e,n){if("number"!=typeof e&&null!=e){var i=0,s=-1,o=t?t.length:0;for(e=Ue(e,n,3);++s<o&&e(t[s],s,t);)i++}else i=null==e||n?1:Hn(0,e);return r(t,i)}function Fe(t,e,n,r){var i=0,s=t?t.length:i;for(n=n?Ue(n,r,1):Xe,e=n(e);s>i;){var o=i+s>>>1;n(t[o])<e?i=o+1:s=o}return i}function Ae(){return d(f(arguments,!0,!0))}function Ee(t,e,n,r){return"boolean"!=typeof e&&null!=e&&(r=n,n="function"!=typeof e&&r&&r[e]===t?null:e,e=!1),null!=n&&(n=Ue(n,r,3)),d(t,e,n)}function Se(t){return l(t,r(arguments,1))}function Pe(){for(var t=-1,e=ee(sr(arguments,"length")),n=Array(0>e?0:e);++t<e;)n[t]=sr(arguments,t);return n}function Oe(t,e){var n=-1,r=t?t.length:0,i={};for(e||!r||zn(t[0])||(e=[]);++n<r;){var s=t[n];e?i[s]=e[n]:s&&(i[s[0]]=s[1])}return i}function je(t,e){if(!B(e))throw new TypeError;return function(){return--t<1?e.apply(this,arguments):void 0}}function De(t,e){return arguments.length>2?v(t,17,r(arguments,2),null,e):v(t,1,null,null,e)}function Ie(t){for(var e=arguments.length>1?f(arguments,!0,!1,1):A(t),n=-1,r=e.length;++n<r;){var i=e[n];t[i]=v(t[i],1,null,null,t)}return t}function Ce(){for(var t=arguments,e=t.length;e--;)if(!B(t[e]))throw new TypeError;return function(){for(var e=arguments,n=t.length;n--;)e=[t[n].apply(this,e)];return e[0]}}function Be(t,e,n){var r,i,s,o,a,u,c,l=0,f=!1,h=!0;if(!B(t))throw new TypeError;if(e=Hn(0,e)||0,n===!0){var p=!0;h=!1}else Y(n)&&(p=n.leading,f="maxWait"in n&&(Hn(e,n.maxWait)||0),h="trailing"in n?n.trailing:h);var d=function(){var n=e-(or()-o);if(0>=n){i&&clearTimeout(i);var f=c;i=u=c=sn,f&&(l=or(),s=t.apply(a,r),u||i||(r=a=null))}else u=setTimeout(d,n)},g=function(){u&&clearTimeout(u),i=u=c=sn,(h||f!==e)&&(l=or(),s=t.apply(a,r),u||i||(r=a=null))};return function(){if(r=arguments,o=or(),a=this,c=h&&(u||!p),f===!1)var n=p&&!u;else{i||p||(l=o);var v=f-(o-l),m=0>=v;m?(i&&(i=clearTimeout(i)),l=o,s=t.apply(a,r)):i||(i=setTimeout(g,v))}return m&&u?u=clearTimeout(u):u||e===f||(u=setTimeout(d,e)),n&&(m=!0,s=t.apply(a,r)),!m||u||i||(r=a=null),s}}function Ye(t){if(!B(t))throw new TypeError;var e=r(arguments,1);return setTimeout(function(){t.apply(sn,e)},1)}function ke(t,e){if(!B(t))throw new TypeError;var n=r(arguments,2);return setTimeout(function(){t.apply(sn,n)},e)}function Ne(t,e){var n={};return function(){var r=e?e.apply(this,arguments):un+arguments[0];return Yn.call(n,r)?n[r]:n[r]=t.apply(this,arguments)}}function Re(t){var e,n;if(!B(t))throw new TypeError;return function(){return e?n:(e=!0,n=t.apply(this,arguments),t=null,n)}}function Le(t){return v(t,16,r(arguments,1))}function $e(t,e,n){var r=!0,i=!0;if(!B(t))throw new TypeError;return n===!1?r=!1:Y(n)&&(r="leading"in n?n.leading:r,i="trailing"in n?n.trailing:i),n={},n.leading=r,n.maxWait=e,n.trailing=i,Be(t,e,n)}function qe(t,e){return v(e,16,[t])}function Ue(t,e,n){var r=typeof t;if(null==t||"function"==r)return u(t,e,n);if("object"!=r)return ze(t);var i=Wn(t);return function(e){for(var n=i.length,r=!1;n--&&(r=e[i[n]]===t[i[n]]););return r}}function He(t){return null==t?"":String(t).replace(Zn,m)}function Xe(t){return t}function Me(t){K(A(t),function(e){var n=i[e]=t[e];i.prototype[e]=function(){var t=[this.__wrapped__];kn.apply(t,arguments);var e=n.apply(i,t);return this.__chain__?new s(e,!0):e}})}function Je(){return xn._=jn,this}function ze(t){return function(e){return e[t]}}function Ge(t,e){return null==t&&null==e&&(e=1),t=+t||0,null==e?(e=t,t=0):e=+e||0,t+Bn(Mn()*(e-t+1))}function We(t,e){if(t){var n=t[e];return B(n)?t[e]():n}}function Ve(t,e,r){var s=i,o=s.templateSettings;t=String(t||""),r=F({},r,o);var a=0,u="__p += '",c=r.variable,l=RegExp((r.escape||ln).source+"|"+(r.interpolate||ln).source+"|"+(r.evaluate||ln).source+"|$","g");t.replace(l,function(e,r,i,s,o){return u+=t.slice(a,o).replace(fn,n),r&&(u+="' +\n_.escape("+r+") +\n'"),s&&(u+="';\n"+s+";\n__p += '"),i&&(u+="' +\n((__t = ("+i+")) == null ? '' : __t) +\n'"),a=o+e.length,e}),u+="';\n",c||(c="obj",u="with ("+c+" || {}) {\n"+u+"\n}\n"),u="function("+c+") {\nvar __t, __p = '', __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n"+u+"return __p\n}";try{var f=Function("_","return "+u)(s)}catch(h){throw h.source=u,h}return e?f(e):(f.source=u,f)}function Ke(t,e,n){t=(t=+t)>-1?t:0;var r=-1,i=Array(t);for(e=u(e,n,1);++r<t;)i[r]=e(r);return i}function Qe(t){return null==t?"":String(t).replace(Qn,T)}function Ze(t){var e=++on+"";return t?t+e:e}function tn(t){return t=new s(t),t.__chain__=!0,t}function en(t,e){return e(t),t}function nn(){return this.__chain__=!0,this}function rn(){return this.__wrapped__}var sn,on=0,an={},un=+new Date+"",cn=/<%=([\s\S]+?)%>/g,ln=/($^)/,fn=/['\n\r\t\u2028\u2029\\]/g,hn="[object Arguments]",pn="[object Array]",dn="[object Boolean]",gn="[object Date]",vn="[object Function]",mn="[object Number]",yn="[object Object]",_n="[object RegExp]",Tn="[object String]",bn={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1},wn={"\\":"\\","'":"'","\n":"n","\r":"r","	":"t","\u2028":"u2028","\u2029":"u2029"},xn=bn[typeof window]&&window||this,Fn=bn[typeof exports]&&exports&&!exports.nodeType&&exports,An=bn[typeof module]&&module&&!module.nodeType&&module,En=An&&An.exports===Fn&&Fn,Sn=bn[typeof global]&&global;!Sn||Sn.global!==Sn&&Sn.window!==Sn||(xn=Sn);var Pn=[],On=Object.prototype,jn=xn._,Dn=On.toString,In=RegExp("^"+String(Dn).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/toString| for [^\]]+/g,".*?")+"$"),Cn=Math.ceil,Bn=Math.floor,Yn=On.hasOwnProperty,kn=Pn.push,Nn=On.propertyIsEnumerable,Rn=_(Rn=Object.create)&&Rn,Ln=_(Ln=Array.isArray)&&Ln,$n=xn.isFinite,qn=xn.isNaN,Un=_(Un=Object.keys)&&Un,Hn=Math.max,Xn=Math.min,Mn=Math.random;s.prototype=i.prototype;var Jn={};!function(){var t={0:1,length:1};Jn.spliceObjects=(Pn.splice.call(t,0,1),!t[0])}(1),i.templateSettings={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:cn,variable:""},Rn||(a=function(){function t(){}return function(e){if(Y(e)){t.prototype=e;var n=new t;t.prototype=null}return n||xn.Object()}}()),b(arguments)||(b=function(t){return t&&"object"==typeof t&&"number"==typeof t.length&&Yn.call(t,"callee")&&!Nn.call(t,"callee")||!1});var zn=Ln||function(t){return t&&"object"==typeof t&&"number"==typeof t.length&&Dn.call(t)==pn||!1},Gn=function(t){var e,n=t,r=[];if(!n)return r;if(!bn[typeof t])return r;for(e in n)Yn.call(n,e)&&r.push(e);return r},Wn=Un?function(t){return Y(t)?Un(t):[]}:Gn,Vn={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"},Kn=S(Vn),Qn=RegExp("("+Wn(Kn).join("|")+")","g"),Zn=RegExp("["+Wn(Vn).join("")+"]","g"),tr=function(t,e){var n,r=t,i=r;if(!r)return i;if(!bn[typeof r])return i;for(n in r)if(e(r[n],n,t)===an)return i;return i},er=function(t,e){var n,r=t,i=r;if(!r)return i;if(!bn[typeof r])return i;for(n in r)if(Yn.call(r,n)&&e(r[n],n,t)===an)return i;return i};B(/x/)&&(B=function(t){return"function"==typeof t&&Dn.call(t)==vn});var nr=g(function(t,e,n){Yn.call(t,n)?t[n]++:t[n]=1}),rr=g(function(t,e,n){(Yn.call(t,n)?t[n]:t[n]=[]).push(e)}),ir=g(function(t,e,n){t[n]=e}),sr=te,or=_(or=Date.now)&&or||function(){return(new Date).getTime()};i.after=je,i.bind=De,i.bindAll=Ie,i.chain=tn,i.compact=pe,i.compose=Ce,i.countBy=nr,i.debounce=Be,i.defaults=F,i.defer=Ye,i.delay=ke,i.difference=de,i.filter=G,i.flatten=ve,i.forEach=K,i.functions=A,i.groupBy=rr,i.indexBy=ir,i.initial=ye,i.intersection=_e,i.invert=S,i.invoke=Z,i.keys=Wn,i.map=te,i.max=ee,i.memoize=Ne,i.min=ne,i.omit=U,i.once=Re,i.pairs=H,i.partial=Le,i.pick=X,i.pluck=sr,i.range=we,i.reject=se,i.rest=xe,i.shuffle=ae,i.sortBy=le,i.tap=en,i.throttle=$e,i.times=Ke,i.toArray=fe,i.union=Ae,i.uniq=Ee,i.values=M,i.where=he,i.without=Se,i.wrap=qe,i.zip=Pe,i.collect=te,i.drop=xe,i.each=K,i.extend=w,i.methods=A,i.object=Oe,i.select=G,i.tail=xe,i.unique=Ee,i.clone=x,i.contains=J,i.escape=He,i.every=z,i.find=W,i.has=E,i.identity=Xe,i.indexOf=me,i.isArguments=b,i.isArray=zn,i.isBoolean=P,i.isDate=O,i.isElement=j,i.isEmpty=D,i.isEqual=I,i.isFinite=C,i.isFunction=B,i.isNaN=k,i.isNull=N,i.isNumber=R,i.isObject=Y,i.isRegExp=L,i.isString=$,i.isUndefined=q,i.lastIndexOf=be,i.mixin=Me,i.noConflict=Je,i.random=Ge,i.reduce=re,i.reduceRight=ie,i.result=We,i.size=ue,i.some=ce,i.sortedIndex=Fe,i.template=Ve,i.unescape=Qe,i.uniqueId=Ze,i.all=z,i.any=ce,i.detect=W,i.findWhere=V,i.foldl=re,i.foldr=ie,i.include=J,i.inject=re,i.first=ge,i.last=Te,i.sample=oe,i.take=ge,i.head=ge,Me(i),i.VERSION="2.4.1",i.prototype.chain=nn,i.prototype.value=rn,K(["pop","push","reverse","shift","sort","splice","unshift"],function(t){var e=Pn[t];i.prototype[t]=function(){var t=this.__wrapped__;return e.apply(t,arguments),Jn.spliceObjects||0!==t.length||delete t[0],this}}),K(["concat","join","slice"],function(t){var e=Pn[t];i.prototype[t]=function(){var t=this.__wrapped__,n=e.apply(t,arguments);return this.__chain__&&(n=new s(n),n.__chain__=!0),n}}),"function"==typeof define&&"object"==typeof define.amd&&define.amd?(xn._=i,define(function(){return i})):Fn&&An?En?(An.exports=i)._=i:Fn._=i:xn._=i}).call(this),function(t,e){if("function"==typeof define&&define.amd)define(["underscore","jquery","exports"],function(n,r,i){t.Backbone=e(t,i,n,r)});else if("undefined"!=typeof exports){var n=require("underscore");e(t,exports,n)}else t.Backbone=e(t,{},t._,t.jQuery||t.Zepto||t.ender||t.$)}(this,function(t,e,n,r){{var i=t.Backbone,s=[],o=(s.push,s.slice);s.splice}e.VERSION="1.1.2",e.$=r,e.noConflict=function(){return t.Backbone=i,this},e.emulateHTTP=!1,e.emulateJSON=!1;var a=e.Events={on:function(t,e,n){if(!c(this,"on",t,[e,n])||!e)return this;this._events||(this._events={});var r=this._events[t]||(this._events[t]=[]);return r.push({callback:e,context:n,ctx:n||this}),this},once:function(t,e,r){if(!c(this,"once",t,[e,r])||!e)return this;var i=this,s=n.once(function(){i.off(t,s),e.apply(this,arguments)});return s._callback=e,this.on(t,s,r)},off:function(t,e,r){var i,s,o,a,u,l,f,h;if(!this._events||!c(this,"off",t,[e,r]))return this;if(!t&&!e&&!r)return this._events=void 0,this;for(a=t?[t]:n.keys(this._events),u=0,l=a.length;l>u;u++)if(t=a[u],o=this._events[t]){if(this._events[t]=i=[],e||r)for(f=0,h=o.length;h>f;f++)s=o[f],(e&&e!==s.callback&&e!==s.callback._callback||r&&r!==s.context)&&i.push(s);i.length||delete this._events[t]}return this},trigger:function(t){if(!this._events)return this;var e=o.call(arguments,1);if(!c(this,"trigger",t,e))return this;var n=this._events[t],r=this._events.all;return n&&l(n,e),r&&l(r,arguments),this},stopListening:function(t,e,r){var i=this._listeningTo;if(!i)return this;var s=!e&&!r;r||"object"!=typeof e||(r=this),t&&((i={})[t._listenId]=t);for(var o in i)t=i[o],t.off(e,r,this),(s||n.isEmpty(t._events))&&delete this._listeningTo[o];return this}},u=/\s+/,c=function(t,e,n,r){if(!n)return!0;if("object"==typeof n){for(var i in n)t[e].apply(t,[i,n[i]].concat(r));return!1}if(u.test(n)){for(var s=n.split(u),o=0,a=s.length;a>o;o++)t[e].apply(t,[s[o]].concat(r));return!1}return!0},l=function(t,e){var n,r=-1,i=t.length,s=e[0],o=e[1],a=e[2];switch(e.length){case 0:for(;++r<i;)(n=t[r]).callback.call(n.ctx);return;case 1:for(;++r<i;)(n=t[r]).callback.call(n.ctx,s);return;case 2:for(;++r<i;)(n=t[r]).callback.call(n.ctx,s,o);return;case 3:for(;++r<i;)(n=t[r]).callback.call(n.ctx,s,o,a);return;default:for(;++r<i;)(n=t[r]).callback.apply(n.ctx,e);return}},f={listenTo:"on",listenToOnce:"once"};n.each(f,function(t,e){a[e]=function(e,r,i){var s=this._listeningTo||(this._listeningTo={}),o=e._listenId||(e._listenId=n.uniqueId("l"));return s[o]=e,i||"object"!=typeof r||(i=this),e[t](r,i,this),this}}),a.bind=a.on,a.unbind=a.off,n.extend(e,a);var h=e.Model=function(t,e){var r=t||{};e||(e={}),this.cid=n.uniqueId("c"),this.attributes={},e.collection&&(this.collection=e.collection),e.parse&&(r=this.parse(r,e)||{}),r=n.defaults({},r,n.result(this,"defaults")),this.set(r,e),this.changed={},this.initialize.apply(this,arguments)};n.extend(h.prototype,a,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(){return n.clone(this.attributes)},sync:function(){return e.sync.apply(this,arguments)},get:function(t){return this.attributes[t]},escape:function(t){return n.escape(this.get(t))},has:function(t){return null!=this.get(t)},set:function(t,e,r){var i,s,o,a,u,c,l,f;if(null==t)return this;if("object"==typeof t?(s=t,r=e):(s={})[t]=e,r||(r={}),!this._validate(s,r))return!1;o=r.unset,u=r.silent,a=[],c=this._changing,this._changing=!0,c||(this._previousAttributes=n.clone(this.attributes),this.changed={}),f=this.attributes,l=this._previousAttributes,this.idAttribute in s&&(this.id=s[this.idAttribute]);for(i in s)e=s[i],n.isEqual(f[i],e)||a.push(i),n.isEqual(l[i],e)?delete this.changed[i]:this.changed[i]=e,o?delete f[i]:f[i]=e;if(!u){a.length&&(this._pending=r);for(var h=0,p=a.length;p>h;h++)this.trigger("change:"+a[h],this,f[a[h]],r)}if(c)return this;if(!u)for(;this._pending;)r=this._pending,this._pending=!1,this.trigger("change",this,r);return this._pending=!1,this._changing=!1,this},unset:function(t,e){return this.set(t,void 0,n.extend({},e,{unset:!0}))},clear:function(t){var e={};for(var r in this.attributes)e[r]=void 0;return this.set(e,n.extend({},t,{unset:!0}))},hasChanged:function(t){return null==t?!n.isEmpty(this.changed):n.has(this.changed,t)},changedAttributes:function(t){if(!t)return this.hasChanged()?n.clone(this.changed):!1;var e,r=!1,i=this._changing?this._previousAttributes:this.attributes;for(var s in t)n.isEqual(i[s],e=t[s])||((r||(r={}))[s]=e);return r},previous:function(t){return null!=t&&this._previousAttributes?this._previousAttributes[t]:null},previousAttributes:function(){return n.clone(this._previousAttributes)},fetch:function(t){t=t?n.clone(t):{},void 0===t.parse&&(t.parse=!0);var e=this,r=t.success;return t.success=function(n){return e.set(e.parse(n,t),t)?(r&&r(e,n,t),void e.trigger("sync",e,n,t)):!1},N(this,t),this.sync("read",this,t)},save:function(t,e,r){var i,s,o,a=this.attributes;if(null==t||"object"==typeof t?(i=t,r=e):(i={})[t]=e,r=n.extend({validate:!0},r),i&&!r.wait){if(!this.set(i,r))return!1}else if(!this._validate(i,r))return!1;i&&r.wait&&(this.attributes=n.extend({},a,i)),void 0===r.parse&&(r.parse=!0);var u=this,c=r.success;return r.success=function(t){u.attributes=a;var e=u.parse(t,r);return r.wait&&(e=n.extend(i||{},e)),n.isObject(e)&&!u.set(e,r)?!1:(c&&c(u,t,r),void u.trigger("sync",u,t,r))},N(this,r),s=this.isNew()?"create":r.patch?"patch":"update","patch"===s&&(r.attrs=i),o=this.sync(s,this,r),i&&r.wait&&(this.attributes=a),o},destroy:function(t){t=t?n.clone(t):{};var e=this,r=t.success,i=function(){e.trigger("destroy",e,e.collection,t)};if(t.success=function(n){(t.wait||e.isNew())&&i(),r&&r(e,n,t),e.isNew()||e.trigger("sync",e,n,t)},this.isNew())return t.success(),!1;N(this,t);var s=this.sync("delete",this,t);return t.wait||i(),s},url:function(){var t=n.result(this,"urlRoot")||n.result(this.collection,"url")||k();return this.isNew()?t:t.replace(/([^\/])$/,"$1/")+encodeURIComponent(this.id)},parse:function(t){return t},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(t){return this._validate({},n.extend(t||{},{validate:!0}))},_validate:function(t,e){if(!e.validate||!this.validate)return!0;t=n.extend({},this.attributes,t);var r=this.validationError=this.validate(t,e)||null;return r?(this.trigger("invalid",this,r,n.extend(e,{validationError:r})),!1):!0}});var p=["keys","values","pairs","invert","pick","omit"];n.each(p,function(t){h.prototype[t]=function(){var e=o.call(arguments);return e.unshift(this.attributes),n[t].apply(n,e)}});var d=e.Collection=function(t,e){e||(e={}),e.model&&(this.model=e.model),void 0!==e.comparator&&(this.comparator=e.comparator),this._reset(),this.initialize.apply(this,arguments),t&&this.reset(t,n.extend({silent:!0},e))},g={add:!0,remove:!0,merge:!0},v={add:!0,remove:!1};n.extend(d.prototype,a,{model:h,initialize:function(){},toJSON:function(t){return this.map(function(e){return e.toJSON(t)})},sync:function(){return e.sync.apply(this,arguments)},add:function(t,e){return this.set(t,n.extend({merge:!1},e,v))},remove:function(t,e){var r=!n.isArray(t);t=r?[t]:n.clone(t),e||(e={});var i,s,o,a;for(i=0,s=t.length;s>i;i++)a=t[i]=this.get(t[i]),a&&(delete this._byId[a.id],delete this._byId[a.cid],o=this.indexOf(a),this.models.splice(o,1),this.length--,e.silent||(e.index=o,a.trigger("remove",a,this,e)),this._removeReference(a,e));return r?t[0]:t},set:function(t,e){e=n.defaults({},e,g),e.parse&&(t=this.parse(t,e));var r=!n.isArray(t);t=r?t?[t]:[]:n.clone(t);var i,s,o,a,u,c,l,f=e.at,p=this.model,d=this.comparator&&null==f&&e.sort!==!1,v=n.isString(this.comparator)?this.comparator:null,m=[],y=[],_={},T=e.add,b=e.merge,w=e.remove,x=!d&&T&&w?[]:!1;for(i=0,s=t.length;s>i;i++){if(u=t[i]||{},o=u instanceof h?a=u:u[p.prototype.idAttribute||"id"],c=this.get(o))w&&(_[c.cid]=!0),b&&(u=u===a?a.attributes:u,e.parse&&(u=c.parse(u,e)),c.set(u,e),d&&!l&&c.hasChanged(v)&&(l=!0)),t[i]=c;else if(T){if(a=t[i]=this._prepareModel(u,e),!a)continue;m.push(a),this._addReference(a,e)}a=c||a,!x||!a.isNew()&&_[a.id]||x.push(a),_[a.id]=!0}if(w){for(i=0,s=this.length;s>i;++i)_[(a=this.models[i]).cid]||y.push(a);y.length&&this.remove(y,e)}if(m.length||x&&x.length)if(d&&(l=!0),this.length+=m.length,null!=f)for(i=0,s=m.length;s>i;i++)this.models.splice(f+i,0,m[i]);else{x&&(this.models.length=0);var F=x||m;for(i=0,s=F.length;s>i;i++)this.models.push(F[i])}if(l&&this.sort({silent:!0}),!e.silent){for(i=0,s=m.length;s>i;i++)(a=m[i]).trigger("add",a,this,e);(l||x&&x.length)&&this.trigger("sort",this,e)}return r?t[0]:t},reset:function(t,e){e||(e={});for(var r=0,i=this.models.length;i>r;r++)this._removeReference(this.models[r],e);return e.previousModels=this.models,this._reset(),t=this.add(t,n.extend({silent:!0},e)),e.silent||this.trigger("reset",this,e),t},push:function(t,e){return this.add(t,n.extend({at:this.length},e))},pop:function(t){var e=this.at(this.length-1);return this.remove(e,t),e},unshift:function(t,e){return this.add(t,n.extend({at:0},e))},shift:function(t){var e=this.at(0);return this.remove(e,t),e},slice:function(){return o.apply(this.models,arguments)},get:function(t){return null==t?void 0:this._byId[t]||this._byId[t.id]||this._byId[t.cid]},at:function(t){return this.models[t]},where:function(t,e){return n.isEmpty(t)?e?void 0:[]:this[e?"find":"filter"](function(e){for(var n in t)if(t[n]!==e.get(n))return!1;return!0})},findWhere:function(t){return this.where(t,!0)},sort:function(t){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return t||(t={}),n.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(n.bind(this.comparator,this)),t.silent||this.trigger("sort",this,t),this},pluck:function(t){return n.invoke(this.models,"get",t)},fetch:function(t){t=t?n.clone(t):{},void 0===t.parse&&(t.parse=!0);var e=t.success,r=this;return t.success=function(n){var i=t.reset?"reset":"set";r[i](n,t),e&&e(r,n,t),r.trigger("sync",r,n,t)},N(this,t),this.sync("read",this,t)},create:function(t,e){if(e=e?n.clone(e):{},!(t=this._prepareModel(t,e)))return!1;e.wait||this.add(t,e);var r=this,i=e.success;return e.success=function(t,n){e.wait&&r.add(t,e),i&&i(t,n,e)},t.save(null,e),t},parse:function(t){return t},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(t,e){if(t instanceof h)return t;e=e?n.clone(e):{},e.collection=this;var r=new this.model(t,e);return r.validationError?(this.trigger("invalid",this,r.validationError,e),!1):r},_addReference:function(t){this._byId[t.cid]=t,null!=t.id&&(this._byId[t.id]=t),t.collection||(t.collection=this),t.on("all",this._onModelEvent,this)},_removeReference:function(t){this===t.collection&&delete t.collection,t.off("all",this._onModelEvent,this)},_onModelEvent:function(t,e,n,r){("add"!==t&&"remove"!==t||n===this)&&("destroy"===t&&this.remove(e,r),e&&t==="change:"+e.idAttribute&&(delete this._byId[e.previous(e.idAttribute)],null!=e.id&&(this._byId[e.id]=e)),this.trigger.apply(this,arguments))}});var m=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","difference","indexOf","shuffle","lastIndexOf","isEmpty","chain","sample"];n.each(m,function(t){d.prototype[t]=function(){var e=o.call(arguments);return e.unshift(this.models),n[t].apply(n,e)}});var y=["groupBy","countBy","sortBy","indexBy"];n.each(y,function(t){d.prototype[t]=function(e,r){var i=n.isFunction(e)?e:function(t){return t.get(e)};return n[t](this.models,i,r)}});var _=e.View=function(t){this.cid=n.uniqueId("view"),t||(t={}),n.extend(this,n.pick(t,b)),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},T=/^(\S+)\s*(.*)$/,b=["model","collection","el","id","attributes","className","tagName","events"];n.extend(_.prototype,a,{tagName:"div",$:function(t){return this.$el.find(t)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(t,n){return this.$el&&this.undelegateEvents(),this.$el=t instanceof e.$?t:e.$(t),this.el=this.$el[0],n!==!1&&this.delegateEvents(),this},delegateEvents:function(t){if(!t&&!(t=n.result(this,"events")))return this;this.undelegateEvents();for(var e in t){var r=t[e];if(n.isFunction(r)||(r=this[t[e]]),r){var i=e.match(T),s=i[1],o=i[2];r=n.bind(r,this),s+=".delegateEvents"+this.cid,""===o?this.$el.on(s,r):this.$el.on(s,o,r)}}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_ensureElement:function(){if(this.el)this.setElement(n.result(this,"el"),!1);else{var t=n.extend({},n.result(this,"attributes"));this.id&&(t.id=n.result(this,"id")),this.className&&(t["class"]=n.result(this,"className"));
var r=e.$("<"+n.result(this,"tagName")+">").attr(t);this.setElement(r,!1)}}}),e.sync=function(t,r,i){var s=x[t];n.defaults(i||(i={}),{emulateHTTP:e.emulateHTTP,emulateJSON:e.emulateJSON});var o={type:s,dataType:"json"};if(i.url||(o.url=n.result(r,"url")||k()),null!=i.data||!r||"create"!==t&&"update"!==t&&"patch"!==t||(o.contentType="application/json",o.data=JSON.stringify(i.attrs||r.toJSON(i))),i.emulateJSON&&(o.contentType="application/x-www-form-urlencoded",o.data=o.data?{model:o.data}:{}),i.emulateHTTP&&("PUT"===s||"DELETE"===s||"PATCH"===s)){o.type="POST",i.emulateJSON&&(o.data._method=s);var a=i.beforeSend;i.beforeSend=function(t){return t.setRequestHeader("X-HTTP-Method-Override",s),a?a.apply(this,arguments):void 0}}"GET"===o.type||i.emulateJSON||(o.processData=!1),"PATCH"===o.type&&w&&(o.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var u=i.xhr=e.ajax(n.extend(o,i));return r.trigger("request",r,u,i),u};var w=!("undefined"==typeof window||!window.ActiveXObject||window.XMLHttpRequest&&(new XMLHttpRequest).dispatchEvent),x={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};e.ajax=function(){return e.$.ajax.apply(e.$,arguments)};var F=e.Router=function(t){t||(t={}),t.routes&&(this.routes=t.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},A=/\((.*?)\)/g,E=/(\(\?)?:\w+/g,S=/\*\w+/g,P=/[\-{}\[\]+?.,\\\^$|#\s]/g;n.extend(F.prototype,a,{initialize:function(){},route:function(t,r,i){n.isRegExp(t)||(t=this._routeToRegExp(t)),n.isFunction(r)&&(i=r,r=""),i||(i=this[r]);var s=this;return e.history.route(t,function(n){var o=s._extractParameters(t,n);s.execute(i,o),s.trigger.apply(s,["route:"+r].concat(o)),s.trigger("route",r,o),e.history.trigger("route",s,r,o)}),this},execute:function(t,e){t&&t.apply(this,e)},navigate:function(t,n){return e.history.navigate(t,n),this},_bindRoutes:function(){if(this.routes){this.routes=n.result(this,"routes");for(var t,e=n.keys(this.routes);null!=(t=e.pop());)this.route(t,this.routes[t])}},_routeToRegExp:function(t){return t=t.replace(P,"\\$&").replace(A,"(?:$1)?").replace(E,function(t,e){return e?t:"([^/?]+)"}).replace(S,"([^?]*?)"),new RegExp("^"+t+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(t,e){var r=t.exec(e).slice(1);return n.map(r,function(t,e){return e===r.length-1?t||null:t?decodeURIComponent(t):null})}});var O=e.History=function(){this.handlers=[],n.bindAll(this,"checkUrl"),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},j=/^[#\/]|\s+$/g,D=/^\/+|\/+$/g,I=/msie [\w.]+/,C=/\/$/,B=/#.*$/;O.started=!1,n.extend(O.prototype,a,{interval:50,atRoot:function(){return this.location.pathname.replace(/[^\/]$/,"$&/")===this.root},getHash:function(t){var e=(t||this).location.href.match(/#(.*)$/);return e?e[1]:""},getFragment:function(t,e){if(null==t)if(this._hasPushState||!this._wantsHashChange||e){t=decodeURI(this.location.pathname+this.location.search);var n=this.root.replace(C,"");t.indexOf(n)||(t=t.slice(n.length))}else t=this.getHash();return t.replace(j,"")},start:function(t){if(O.started)throw new Error("Backbone.history has already been started");O.started=!0,this.options=n.extend({root:"/"},this.options,t),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var r=this.getFragment(),i=document.documentMode,s=I.exec(navigator.userAgent.toLowerCase())&&(!i||7>=i);if(this.root=("/"+this.root+"/").replace(D,"/"),s&&this._wantsHashChange){var o=e.$('<iframe src="javascript:0" tabindex="-1">');this.iframe=o.hide().appendTo("body")[0].contentWindow,this.navigate(r)}this._hasPushState?e.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!s?e.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=r;var a=this.location;if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot())return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+"#"+this.fragment),!0;this._hasPushState&&this.atRoot()&&a.hash&&(this.fragment=this.getHash().replace(j,""),this.history.replaceState({},document.title,this.root+this.fragment))}return this.options.silent?void 0:this.loadUrl()},stop:function(){e.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),O.started=!1},route:function(t,e){this.handlers.unshift({route:t,callback:e})},checkUrl:function(){var t=this.getFragment();return t===this.fragment&&this.iframe&&(t=this.getFragment(this.getHash(this.iframe))),t===this.fragment?!1:(this.iframe&&this.navigate(t),void this.loadUrl())},loadUrl:function(t){return t=this.fragment=this.getFragment(t),n.any(this.handlers,function(e){return e.route.test(t)?(e.callback(t),!0):void 0})},navigate:function(t,e){if(!O.started)return!1;e&&e!==!0||(e={trigger:!!e});var n=this.root+(t=this.getFragment(t||""));if(t=t.replace(B,""),this.fragment!==t){if(this.fragment=t,""===t&&"/"!==n&&(n=n.slice(0,-1)),this._hasPushState)this.history[e.replace?"replaceState":"pushState"]({},document.title,n);else{if(!this._wantsHashChange)return this.location.assign(n);this._updateHash(this.location,t,e.replace),this.iframe&&t!==this.getFragment(this.getHash(this.iframe))&&(e.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,t,e.replace))}return e.trigger?this.loadUrl(t):void 0}},_updateHash:function(t,e,n){if(n){var r=t.href.replace(/(javascript:|#).*$/,"");t.replace(r+"#"+e)}else t.hash="#"+e}}),e.history=new O;var Y=function(t,e){var r,i=this;r=t&&n.has(t,"constructor")?t.constructor:function(){return i.apply(this,arguments)},n.extend(r,i,e);var s=function(){this.constructor=r};return s.prototype=i.prototype,r.prototype=new s,t&&n.extend(r.prototype,t),r.__super__=i.prototype,r};h.extend=d.extend=F.extend=_.extend=O.extend=Y;var k=function(){throw new Error('A "url" property or function must be specified')},N=function(t,e){var n=e.error;e.error=function(r){n&&n(t,r,e),t.trigger("error",t,r,e)}};return e});var TAFFY,exports,T;!function(){var t,e,n,r,i,s,o,a,u,c,l,f,h,p,d,g,v,m,y,_,b,w,x;if(!TAFFY)for(i="2.7",s=1,o="000000",a=1e3,u={},c=function(t){return TAFFY.isArray(t)||TAFFY.isObject(t)?t:JSON.parse(t)},y=function(t,e){return _(t,function(t){return e.indexOf(t)>=0})},_=function(t,e,n){var r=[];return null==t?r:Array.prototype.filter&&t.filter===Array.prototype.filter?t.filter(e,n):(l(t,function(t,i,s){e.call(n,t,i,s)&&(r[r.length]=t)}),r)},x=function(t){return"[object RegExp]"===Object.prototype.toString.call(t)},w=function(t){var e=T.isArray(t)?[]:T.isObject(t)?{}:null;if(null===t)return t;for(var n in t)e[n]=x(t[n])?t[n].toString():T.isArray(t[n])||T.isObject(t[n])?w(t[n]):t[n];return e},b=function(t){var e=JSON.stringify(t);return null===e.match(/regex/)?e:JSON.stringify(w(t))},l=function(t,e,n){var r,i,s,o;if(t&&(T.isArray(t)&&1===t.length||!T.isArray(t)))e(T.isArray(t)?t[0]:t,0);else for(s=0,t=T.isArray(t)?t:[t],o=t.length;o>s&&(i=t[s],T.isUndefined(i)&&!n||(r=e(i,s),r!==T.EXIT));s++);},f=function(t,e){var n,r,i=0;for(r in t)if(t.hasOwnProperty(r)&&(n=e(t[r],r,i++),n===T.EXIT))break},u.extend=function(t,e){u[t]=function(){return e.apply(this,arguments)}},h=function(t){var e;return T.isString(t)&&/[t][0-9]*[r][0-9]*/i.test(t)?!0:T.isObject(t)&&t.___id&&t.___s?!0:T.isArray(t)?(e=!0,l(t,function(t){return h(t)?void 0:(e=!1,TAFFY.EXIT)}),e):!1},d=function(t,e){var n=!0;return l(e,function(e){switch(T.typeOf(e)){case"function":if(!e.apply(t))return n=!1,TAFFY.EXIT;break;case"array":n=1===e.length?d(t,e[0]):2===e.length?d(t,e[0])||d(t,e[1]):3===e.length?d(t,e[0])||d(t,e[1])||d(t,e[2]):4===e.length?d(t,e[0])||d(t,e[1])||d(t,e[2])||d(t,e[3]):!1,e.length>4&&l(e,function(e){d(t,e)&&(n=!0)})}}),n},p=function(t){var e=[];return T.isString(t)&&/[t][0-9]*[r][0-9]*/i.test(t)&&(t={___id:t}),T.isArray(t)?(l(t,function(t){e.push(p(t))}),t=function(){var t=this,n=!1;return l(e,function(e){d(t,e)&&(n=!0)}),n}):T.isObject(t)?(T.isObject(t)&&t.___id&&t.___s&&(t={___id:t.___id}),f(t,function(t,n){T.isObject(t)||(t={is:t}),f(t,function(t,r){var i,s=[];i="hasAll"===r?function(t,e){e(t)}:l,i(t,function(t){var e,i=!0;e=function(){var e,s=this[n],o="==",a="!=",u="===",c="<",l=">",f="<=",h=">=",p="!==";return"undefined"==typeof s?!1:(0===r.indexOf("!")&&r!==a&&r!==p&&(i=!1,r=r.substring(1,r.length)),e="regex"===r?t.test(s):"lt"===r||r===c?t>s:"gt"===r||r===l?s>t:"lte"===r||r===f?t>=s:"gte"===r||r===h?s>=t:"left"===r?0===s.indexOf(t):"leftnocase"===r?0===s.toLowerCase().indexOf(t.toLowerCase()):"right"===r?s.substring(s.length-t.length)===t:"rightnocase"===r?s.toLowerCase().substring(s.length-t.length)===t.toLowerCase():"like"===r?s.indexOf(t)>=0:"likenocase"===r?s.toLowerCase().indexOf(t.toLowerCase())>=0:r===u||"is"===r?s===t:r===o?s==t:r===p?s!==t:r===a?s!=t:"isnocase"===r?s.toLowerCase?s.toLowerCase()===t.toLowerCase():s===t:"has"===r?T.has(s,t):"hasall"===r?T.hasAll(s,t):"contains"===r?TAFFY.isArray(s)&&s.indexOf(t)>-1:-1!==r.indexOf("is")||TAFFY.isNull(s)||TAFFY.isUndefined(s)||TAFFY.isObject(t)||TAFFY.isArray(t)?T[r]&&T.isFunction(T[r])&&0===r.indexOf("is")?T[r](s)===t:T[r]&&T.isFunction(T[r])?T[r](s,t):!1:t===s[r],e=e&&!i?!1:e||i?e:!0)},s.push(e)}),e.push(1===s.length?s[0]:function(){var t=this,e=!1;return l(s,function(n){n.apply(t)&&(e=!0)}),e})})}),t=function(){var t=this,n=!0;return n=1!==e.length||e[0].apply(t)?2!==e.length||e[0].apply(t)&&e[1].apply(t)?3!==e.length||e[0].apply(t)&&e[1].apply(t)&&e[2].apply(t)?4!==e.length||e[0].apply(t)&&e[1].apply(t)&&e[2].apply(t)&&e[3].apply(t)?!0:!1:!1:!1:!1,e.length>4&&l(e,function(e){d(t,e)||(n=!1)}),n}):T.isFunction(t)?t:void 0},v=function(t,e){var n=function(t,n){var r=0;return T.each(e,function(e){var i,s,o,a,u;if(i=e.split(" "),s=i[0],o=1===i.length?"logical":i[1],"logical"===o)a=g(t[s]),u=g(n[s]),T.each(a.length<=u.length?a:u,function(t,e){return a[e]<u[e]?(r=-1,TAFFY.EXIT):a[e]>u[e]?(r=1,TAFFY.EXIT):void 0});else if("logicaldesc"===o)a=g(t[s]),u=g(n[s]),T.each(a.length<=u.length?a:u,function(t,e){return a[e]>u[e]?(r=-1,TAFFY.EXIT):a[e]<u[e]?(r=1,TAFFY.EXIT):void 0});else{if("asec"===o&&t[s]<n[s])return r=-1,T.EXIT;if("asec"===o&&t[s]>n[s])return r=1,T.EXIT;if("desc"===o&&t[s]>n[s])return r=-1,T.EXIT;if("desc"===o&&t[s]<n[s])return r=1,T.EXIT}return 0===r&&"logical"===o&&a.length<u.length?r=-1:0===r&&"logical"===o&&a.length>u.length?r=1:0===r&&"logicaldesc"===o&&a.length>u.length?r=-1:0===r&&"logicaldesc"===o&&a.length<u.length&&(r=1),0!==r?T.EXIT:void 0}),r};return t&&t.push?t.sort(n):t},function(){var t={},e=0;g=function(n){return e>a&&(t={},e=0),t["_"+n]||function(){var r,i,s,o=String(n),a=[],u="_",c="";for(r=0,i=o.length;i>r;r++)s=o.charCodeAt(r),s>=48&&57>=s||46===s?("n"!==c&&(c="n",a.push(u.toLowerCase()),u=""),u+=o.charAt(r)):("s"!==c&&(c="s",a.push(parseFloat(u)),u=""),u+=o.charAt(r));return a.push("n"===c?parseFloat(u):u.toLowerCase()),a.shift(),t["_"+n]=a,e++,a}()}}(),m=function(){this.context({results:this.getDBI().query(this.context())})},u.extend("filter",function(){var t=TAFFY.mergeObj(this.context(),{run:null}),e=[];return l(t.q,function(t){e.push(t)}),t.q=e,l(arguments,function(e){t.q.push(p(e)),t.filterRaw.push(e)}),this.getroot(t)}),u.extend("order",function(t){t=t.split(",");var e,n=[];return l(t,function(t){n.push(t.replace(/^\s*/,"").replace(/\s*$/,""))}),e=TAFFY.mergeObj(this.context(),{sort:null}),e.order=n,this.getroot(e)}),u.extend("limit",function(t){var e,n=TAFFY.mergeObj(this.context(),{});return n.limit=t,n.run&&n.sort&&(e=[],l(n.results,function(n,r){return r+1>t?TAFFY.EXIT:void e.push(n)}),n.results=e),this.getroot(n)}),u.extend("start",function(t){var e,n=TAFFY.mergeObj(this.context(),{});return n.start=t,n.run&&n.sort&&!n.limit?(e=[],l(n.results,function(n,r){r+1>t&&e.push(n)}),n.results=e):n=TAFFY.mergeObj(this.context(),{run:null,start:t}),this.getroot(n)}),u.extend("update",function(t,e,n){var r,i=!0,s={},o=arguments;return!TAFFY.isString(t)||2!==arguments.length&&3!==arguments.length?(s=t,2===o.length&&(i=e)):(s[t]=e,3===arguments.length&&(i=n)),r=this,m.call(this),l(this.context().results,function(t){var e=s;TAFFY.isFunction(e)?e=e.apply(TAFFY.mergeObj(t,{})):T.isFunction(e)&&(e=e(TAFFY.mergeObj(t,{}))),TAFFY.isObject(e)&&r.getDBI().update(t.___id,e,i)}),this.context().results.length&&this.context({run:null}),this}),u.extend("remove",function(t){var e=this,n=0;return m.call(this),l(this.context().results,function(t){e.getDBI().remove(t.___id),n++}),this.context().results.length&&(this.context({run:null}),e.getDBI().removeCommit(t)),n}),u.extend("count",function(){return m.call(this),this.context().results.length}),u.extend("callback",function(t,e){if(t){var n=this;setTimeout(function(){m.call(n),t.call(n.getroot(n.context()))},e||0)}return null}),u.extend("get",function(){return m.call(this),this.context().results}),u.extend("stringify",function(){return JSON.stringify(this.get())}),u.extend("first",function(){return m.call(this),this.context().results[0]||!1}),u.extend("last",function(){return m.call(this),this.context().results[this.context().results.length-1]||!1}),u.extend("sum",function(){var t=0,e=this;return m.call(e),l(arguments,function(n){l(e.context().results,function(e){t+=e[n]||0})}),t}),u.extend("min",function(t){var e=null;return m.call(this),l(this.context().results,function(n){(null===e||n[t]<e)&&(e=n[t])}),e}),function(){var t=function(){var t,e,n;return t=function(t,e,n){var r,i,s;switch(2===n.length?(r=t[n[0]],s="===",i=e[n[1]]):(r=t[n[0]],s=n[1],i=e[n[2]]),s){case"===":return r===i;case"!==":return r!==i;case"<":return i>r;case">":return r>i;case"<=":return i>=r;case">=":return r>=i;case"==":return r==i;case"!=":return r!=i;default:throw String(s)+" is not supported"}},e=function(t,e){var n,r,i={};for(n in t)t.hasOwnProperty(n)&&(i[n]=t[n]);for(n in e)e.hasOwnProperty(n)&&"___id"!==n&&"___s"!==n&&(r=TAFFY.isUndefined(i[n])?"":"right_",i[r+String(n)]=e[n]);return i},n=function(n){var r,i,s=arguments,o=s.length,a=[];if("function"!=typeof n.filter){if(!n.TAFFY)throw"TAFFY DB or result not supplied";r=n()}else r=n;return this.context({results:this.getDBI().query(this.context())}),TAFFY.each(this.context().results,function(n){r.each(function(r){var u,c=!0;t:for(i=1;o>i&&(u=s[i],c="function"==typeof u?u(n,r):"object"==typeof u&&u.length?t(n,r,u):!1,c);i++);c&&a.push(e(n,r))})}),TAFFY(a)()}}();u.extend("join",t)}(),u.extend("max",function(t){var e=null;return m.call(this),l(this.context().results,function(n){(null===e||n[t]>e)&&(e=n[t])}),e}),u.extend("select",function(){var t=[],e=arguments;return m.call(this),1===arguments.length?l(this.context().results,function(n){t.push(n[e[0]])}):l(this.context().results,function(n){var r=[];l(e,function(t){r.push(n[t])}),t.push(r)}),t}),u.extend("distinct",function(){var t=[],e=arguments;return m.call(this),1===arguments.length?l(this.context().results,function(n){var r=n[e[0]],i=!1;l(t,function(t){return r===t?(i=!0,TAFFY.EXIT):void 0}),i||t.push(r)}):l(this.context().results,function(n){var r=[],i=!1;l(e,function(t){r.push(n[t])}),l(t,function(t){var n=!0;return l(e,function(e,i){return r[i]!==t[i]?(n=!1,TAFFY.EXIT):void 0}),n?(i=!0,TAFFY.EXIT):void 0}),i||t.push(r)}),t}),u.extend("supplant",function(t,e){var n=[];return m.call(this),l(this.context().results,function(e){n.push(t.replace(/\{([^\{\}]*)\}/g,function(t,n){var r=e[n];return"string"==typeof r||"number"==typeof r?r:t}))}),e?n:n.join("")}),u.extend("each",function(t){return m.call(this),l(this.context().results,t),this}),u.extend("map",function(t){var e=[];return m.call(this),l(this.context().results,function(n){e.push(t(n))}),e}),T=function(t){var e,n,r,i=[],a={},g=1,m={template:!1,onInsert:!1,onUpdate:!1,onRemove:!1,onDBChange:!1,storageName:!1,forcePropertyCase:null,cacheSize:100,name:""},y=new Date,_=0,w=0,x={};return n=function(t){var e=[],r=!1;return 0===t.length?i:(l(t,function(t){T.isString(t)&&/[t][0-9]*[r][0-9]*/i.test(t)&&i[a[t]]&&(e.push(i[a[t]]),r=!0),T.isObject(t)&&t.___id&&t.___s&&i[a[t.___id]]&&(e.push(i[a[t.___id]]),r=!0),T.isArray(t)&&l(t,function(t){l(n(t),function(t){e.push(t)})})}),r&&e.length>1&&(e=[]),e)},e={dm:function(t){return t&&(y=t,x={},_=0,w=0),m.onDBChange&&setTimeout(function(){m.onDBChange.call(i)},0),m.storageName&&setTimeout(function(){localStorage.setItem("taffy_"+m.storageName,JSON.stringify(i))}),y},insert:function(t,n){var u=[],h=[],p=c(t);return l(p,function(t,r){var c,p;return T.isArray(t)&&0===r?(l(t,function(t){u.push("lower"===m.forcePropertyCase?t.toLowerCase():"upper"===m.forcePropertyCase?t.toUpperCase():t)}),!0):(T.isArray(t)?(c={},l(t,function(t,e){c[u[e]]=t}),t=c):T.isObject(t)&&m.forcePropertyCase&&(p={},f(t,function(e,n){p["lower"===m.forcePropertyCase?n.toLowerCase():"upper"===m.forcePropertyCase?n.toUpperCase():n]=t[n]}),t=p),g++,t.___id="T"+String(o+s).slice(-6)+"R"+String(o+g).slice(-6),t.___s=!0,h.push(t.___id),m.template&&(t=T.mergeObj(m.template,t)),i.push(t),a[t.___id]=i.length-1,m.onInsert&&(n||TAFFY.isUndefined(n))&&m.onInsert.call(t),void e.dm(new Date))}),r(h)},sort:function(t){return i=v(i,t.split(",")),a={},l(i,function(t,e){a[t.___id]=e}),e.dm(new Date),!0},update:function(t,n,r){var s,o,u,c,l={};m.forcePropertyCase&&(f(n,function(t,e){l["lower"===m.forcePropertyCase?e.toLowerCase():"upper"===m.forcePropertyCase?e.toUpperCase():e]=t}),n=l),s=i[a[t]],o=T.mergeObj(s,n),u={},c=!1,f(o,function(t,e){(TAFFY.isUndefined(s[e])||s[e]!==t)&&(u[e]=t,c=!0)}),c&&(m.onUpdate&&(r||TAFFY.isUndefined(r))&&m.onUpdate.call(o,i[a[t]],u),i[a[t]]=o,e.dm(new Date))},remove:function(t){i[a[t]].___s=!1},removeCommit:function(t){var n;for(n=i.length-1;n>-1;n--)i[n].___s||(m.onRemove&&(t||TAFFY.isUndefined(t))&&m.onRemove.call(i[n]),a[i[n].___id]=void 0,i.splice(n,1));a={},l(i,function(t,e){a[t.___id]=e}),e.dm(new Date)},query:function(t){var r,s,o,a,u,c;if(m.cacheSize&&(s="",l(t.filterRaw,function(t){return T.isFunction(t)?(s="nocache",TAFFY.EXIT):void 0}),""===s&&(s=b(T.mergeObj(t,{q:!1,run:!1,sort:!1})))),!t.results||!t.run||t.run&&e.dm()>t.run){if(o=[],m.cacheSize&&x[s])return x[s].i=_++,x[s].results;0===t.q.length&&0===t.index.length?(l(i,function(t){o.push(t)}),r=o):(a=n(t.index),l(a,function(e){(0===t.q.length||d(e,t.q))&&o.push(e)}),r=o)}else r=t.results;return!(t.order.length>0)||t.run&&t.sort||(r=v(r,t.order)),r.length&&(t.limit&&t.limit<r.length||t.start)&&(u=[],l(r,function(e,n){if(!t.start||t.start&&n+1>=t.start)if(t.limit){if(c=t.start?n+1-t.start:n,c<t.limit)u.push(e);else if(c>t.limit)return TAFFY.EXIT}else u.push(e)}),r=u),m.cacheSize&&"nocache"!==s&&(w++,setTimeout(function(){var t,e;w>=2*m.cacheSize&&(w=0,t=_-m.cacheSize,e={},f(function(n,r){n.i>=t&&(e[r]=n)}),x=e)},0),x[s]={i:_++,results:r}),r}},r=function(){var t,n;return t=TAFFY.mergeObj(TAFFY.mergeObj(u,{insert:void 0}),{getDBI:function(){return e},getroot:function(t){return r.call(t)},context:function(t){return t&&(n=TAFFY.mergeObj(n,t.hasOwnProperty("results")?TAFFY.mergeObj(t,{run:new Date,sort:new Date}):t)),n},extend:void 0}),n=this&&this.q?this:{limit:!1,start:!1,q:[],filterRaw:[],index:[],order:[],results:!1,run:null,sort:null,settings:m},l(arguments,function(t){h(t)?n.index.push(t):n.q.push(p(t)),n.filterRaw.push(t)}),t},s++,t&&e.insert(t),r.insert=e.insert,r.merge=function(t,n,i){var s={},o=[],a={};return i=i||!1,n=n||"id",l(t,function(t){var a;s[n]=t[n],o.push(t[n]),a=r(s).first(),a?e.update(a.___id,t,i):e.insert(t,i)}),a[n]=o,r(a)},r.TAFFY=!0,r.sort=e.sort,r.settings=function(t){return t&&(m=TAFFY.mergeObj(m,t),t.template&&r().update(t.template)),m},r.store=function(t){var e,n=!1;return localStorage&&(t&&(e=localStorage.getItem("taffy_"+t),e&&e.length>0&&(r.insert(e),n=!0),i.length>0&&setTimeout(function(){localStorage.setItem("taffy_"+m.storageName,JSON.stringify(i))})),r.settings({storageName:t})),r},r},TAFFY=T,T.each=l,T.eachin=f,T.extend=u.extend,TAFFY.EXIT="TAFFYEXIT",TAFFY.mergeObj=function(t,e){var n={};return f(t,function(e,r){n[r]=t[r]}),f(e,function(t,r){n[r]=e[r]}),n},TAFFY.has=function(t,e){var n,r=!1;if(t.TAFFY)return r=t(e),r.length>0?!0:!1;switch(T.typeOf(t)){case"object":if(T.isObject(e))f(e,function(n,i){return r!==!0||T.isUndefined(t[i])||!t.hasOwnProperty(i)?(r=!1,TAFFY.EXIT):void(r=T.has(t[i],e[i]))});else if(T.isArray(e))l(e,function(n,i){return r=T.has(t,e[i]),r?TAFFY.EXIT:void 0});else if(T.isString(e))return TAFFY.isUndefined(t[e])?!1:!0;return r;case"array":if(T.isObject(e))l(t,function(n,i){return r=T.has(t[i],e),r===!0?TAFFY.EXIT:void 0});else if(T.isArray(e))l(e,function(n,i){return l(t,function(n,s){return r=T.has(t[s],e[i]),r===!0?TAFFY.EXIT:void 0}),r===!0?TAFFY.EXIT:void 0});else if(T.isString(e)||T.isNumber(e))for(r=!1,n=0;n<t.length;n++)if(r=T.has(t[n],e))return!0;return r;case"string":if(T.isString(e)&&e===t)return!0;break;default:if(T.typeOf(t)===T.typeOf(e)&&t===e)return!0}return!1},TAFFY.hasAll=function(t,e){var n,r=TAFFY;return r.isArray(e)?(n=!0,l(e,function(e){return n=r.has(t,e),n===!1?TAFFY.EXIT:void 0}),n):r.has(t,e)},TAFFY.typeOf=function(t){var e=typeof t;return"object"===e&&(t?"number"!=typeof t.length||t.propertyIsEnumerable("length")||(e="array"):e="null"),e},TAFFY.getObjectKeys=function(t){var e=[];return f(t,function(t,n){e.push(n)}),e.sort(),e},TAFFY.isSameArray=function(t,e){return TAFFY.isArray(t)&&TAFFY.isArray(e)&&t.join(",")===e.join(",")?!0:!1},TAFFY.isSameObject=function(t,e){var n=TAFFY,r=!0;return n.isObject(t)&&n.isObject(e)?n.isSameArray(n.getObjectKeys(t),n.getObjectKeys(e))?f(t,function(i,s){return n.isObject(t[s])&&n.isObject(e[s])&&n.isSameObject(t[s],e[s])||n.isArray(t[s])&&n.isArray(e[s])&&n.isSameArray(t[s],e[s])||t[s]===e[s]?void 0:(r=!1,TAFFY.EXIT)}):r=!1:r=!1,r},t=["String","Number","Object","Array","Boolean","Null","Function","Undefined"],e=function(t){return function(e){return TAFFY.typeOf(e)===t.toLowerCase()?!0:!1}},n=0;n<t.length;n++)r=t[n],TAFFY["is"+r]=e(r)}(),"object"==typeof exports&&(exports.taffy=TAFFY);var DrivePass=DrivePass||{};DrivePass.Browser={isChrome:function(){return/Chrome/.test(navigator.userAgent)},ChromeExt:function(){chrome.runtime?chrome.runtime.onMessage||(chrome.runtime.onMessage=chrome.extension.onMessage,chrome.runtime.sendMessage=chrome.extension.sendMessage,chrome.runtime.onConnect=chrome.extension.onConnect,chrome.runtime.connect=chrome.extension.connect):chrome.runtime=chrome.extension},isFirefox:function(){return/Firefox/.test(navigator.userAgent)},sendToPage:function(t){var e=t||{};return 2!==Object.keys(e).length?!1:void(this.isChrome()&&chrome.tabs.getSelected(null,function(t){chrome.tabs.sendMessage(t.id,{password:e.password,username:e.username},function(t){console.log(t.dom)})}))},getActiveTab:function(t){this.isChrome()&&chrome.tabs.query({active:!0,lastFocusedWindow:!0},function(e){var n=e[0];this.activeTabUrl=utils.getHostname(n.url),"function"==typeof t&&t()}.bind(this))},oAuthSendRequest:function(t,e,n){this.isChrome()&&(this.ChromeExt(),chrome.runtime.getBackgroundPage(function(r){r.oauth.sendSignedRequest(t,e,n)}))}};var DrivePass=DrivePass||{};DrivePass.Filters={findPW:function(t,e){var n=t||{},r=[];if(_.keys(n).length>0){for(var i in n)-1!==e.indexOf(n[i].site.trim())&&r.push(n[i].username,n[i].password,n[i].site);return r}throw new Error("findPW: data not an object")},filterResults:function(t){var e=t||{},n=0,r={},i=e.feed.entry,s=DrivePass.Settings.gs_sheet_init.columns;for(var o in i){r[n]={};for(var a=0;a<s.length;a++){var u="gsx$"+s[a];r[n][s[a]]=i[o][u].$t}n++}return r},createDBarray:function(t){var e=t||{},n=0,r=e.feed.entry,i=DrivePass.Settings.gs_sheet_init.columns,s=[];for(var o in r){for(var a={},u=0;u<i.length;u++){var c="gsx$"+i[u];a[i[u]]=r[o][c].$t}s.push(a),n++}return s}};var DrivePass=DrivePass||{};DrivePass.GoogleDrive=function(){var t={};t.driveAPI="https://www.googleapis.com/upload/drive/v2/files";var e=function(t,e){console.log(t),console.log(e)},n=function(t,e){var n="-------314159265358979323846",i="\r\n--"+n+"\r\n",s="\r\n--"+n+"--",o=new FileReader;o.readAsBinaryString(t),o.onload=function(){var n=t.type||"application/octet-stream",a={title:t.fileName,mimeType:n},u=btoa(o.result),c=i+"Content-Type: application/json\r\n\r\n"+JSON.stringify(a)+i+"Content-Type: "+n+"\r\nContent-Transfer-Encoding: base64\r\n\r\n"+u+s;r(c,e)}},r=function(n,r){t.cb="function"==typeof r?r:e;var i="-------314159265358979323846",s={method:"POST",params:{convert:!0,uploadType:"multipart",visibility:"private"},headers:{"Content-Type":'multipart/mixed; boundary="'+i+'"'},body:n};DrivePass.Browser.oAuthSendRequest(t.driveAPI,t.cb,s)},i=function(){var t=new Blob(["site,username,password"],{type:"text/csv",fileName:"DrivePass DB"});n(t,e)};return{init:i}};var DrivePass=DrivePass||{};DrivePass.GoogleSpreadsheet=function(){var t,e={},n=function(n,r){return 200!==r.status?(t={success:!1,message:r.status+": Connection Failed"},console.warn(r)):(t={success:!0,message:"spreadsheet successfully loaded"},t.sheetData=JSON.parse(n)),null!==e.cb&&e.cb(t),t},r=function(t){e.cb="function"==typeof t?t:null;var r={headers:{"GData-Version":"3.0"},parameters:{alt:"json",showfolders:"true"}};DrivePass.Browser.oAuthSendRequest(e.jsonListUrl,n,r)},i=function(t,n){e.cb="function"==typeof n?n:null;var r={method:"POST",headers:{"GData-Version":"3.0","Content-Type":"application/atom+xml"},body:s(t)};DrivePass.Browser.oAuthSendRequest(e.jsonListUrl,u,r)},s=function(t){for(var n='<entry xmlns="http://www.w3.org/2005/Atom" xmlns:gsx="http://schemas.google.com/spreadsheets/2006/extended">\n',r=e.columns,i=0;i<r.length;i++)n+="<gsx:"+r[i]+">"+t[i]+"</gsx:"+r[i]+">\n";return n+="</entry>"},o=function(t,n){var r="<entry xmlns='http://www.w3.org/2005/Atom' xmlns:gsx='http://schemas.google.com/spreadsheets/2006/extended' ";r+="xmlns:gd='http://schemas.google.com/g/2005' gd:etag='"+t.gd$etag+"'>\n",r+="<id>"+t.id.$t+"</id>\n",r+="<updated>"+t.updated.$t+"</updated>\n",r+='<category scheme="http://schemas.google.com/spreadsheets/2006" term="http://schemas.google.com/spreadsheets/2006#list"/>\n',r+="<title type='text'>"+t.title.$t+"</title>\n",r+="<content type='text'>"+t.content.$t+"</content>\n",r+='<link rel="self" type="application/atom+xml" href="'+t.link[0].href+'"/>\n',r+='<link rel="edit" type="application/atom+xml" href="'+t.link[1].href+'"/>\n';for(var i=e.columns,s=0;s<i.length;s++)r+="<gsx:"+i[s]+">"+n[s]+"</gsx:"+i[s]+">\n";return r+="</entry>"},a=function(t,n,r){e.cb="function"==typeof r?r:null;var i={method:"PUT",headers:{"GData-Version":"3.0","Content-Type":"application/atom+xml","if-match":"*"},body:o(t,n)};DrivePass.Browser.oAuthSendRequest(t.link[1].href,c,i)},u=function(n,r){return 201!==r.status?(t={success:!1,message:r.status+": error saving"},console.warn(r)):t={success:!0,message:"saved successfully"},null!==e.cb&&e.cb(t),t},c=function(n,r){return 200!==r.status?(t={success:!1,message:r.status+": error updating"},console.warn(r)):t={success:!0,message:"update successful"},null!==e.cb&&e.cb(t),t},l=function(n,r){return 200!==r.status?(t={success:!1,message:r.status+": error querying"},console.warn(r)):(t={success:!0,message:"query successful"},t.queryData=JSON.parse(n)),null!==e.cb&&e.cb(t),t},f=function(t,n,r){var i=t+"="+n;e.cb="function"==typeof r?r:null;var s={method:"GET",parameters:{alt:"json",sq:i.replace(" ","%20")}};DrivePass.Browser.oAuthSendRequest(e.jsonListUrl,l,s)},h=function(t){if(e=t||{},"string"!=typeof e.sheet_url||"object"!=typeof e.columns)throw new Error("Missing sheet_url or columns from init options");var n,r,i=e.sheet_url;if(i.match(/http(s)*:/)){n=i;try{r=n.match(/key=(.*?)(&|#)/)[1]}catch(s){r=n.match(/(cells|list)\/(.*?)\//)[2]}}else r=i;return e.jsonListUrl="https://spreadsheets.google.com/feeds/list/"+r+"/od6/private/full",e.jsonCellsUrl="https://spreadsheets.google.com/feeds/cells/"+r+"/od6/private/basic",this};return{init:h,load:r,add:i,update:a,query:f}};var DrivePass=DrivePass||{};DrivePass.Options=function(){function t(){var t=r.value,e=n.value;localStorage.setItem("sheet_url",t),localStorage.setItem("app_name",e),DrivePass.Settings.gs_sheet_init.sheet_url=t,DrivePass.ResetLocal().init(function(){i.textContent="Options Saved.",u&&_.delay(chrome.runtime.reload,1e3)})}function e(){var t=localStorage.getItem("sheet_url"),e=localStorage.getItem("app_name");return n.value=e,null===t||""===t?!1:(r.value=t,o.textContent="update",a.href=t,a.style.display="block",void 0)}var n=document.getElementById("appName"),r=document.getElementById("sheet_url"),i=document.getElementById("status"),s=document.getElementById("setAppName"),o=document.getElementById("save"),a=document.getElementById("goToSheet"),u=(document.getElementById("makeSheet"),!1);utils.toggler("inst_link","instructions");var c=localStorage.getItem("app_name");null===c&&(s.classList.add("show"),u=!0),document.addEventListener("DOMContentLoaded",e),o.addEventListener("click",t)};var DrivePass=DrivePass||{};DrivePass.Generator=function(){var t=document.getElementById("uppercase"),e=document.getElementById("lowercase"),n=document.getElementById("numbers"),r=document.getElementById("show_symbols"),i=document.getElementById("symbols"),s=document.getElementById("pw"),o=function(){var s="",o=0,a="",u=document.getElementById("digits").value||26;return 4>u&&(u=4),[t,e,n].forEach(function(t){t.checked===!0&&(a+=t.value,s+=_.sample(t.value),o++)}),r.checked===!0&&(a+=i.value,s+=_.sample(i.value),o++),[u,a,s,o]},a=function(t){t.preventDefault();var e=o(),n=e[0]-e[3],r=e[1],i="";return i=_.sample(r,n).join(""),i+=e[2],s.textContent=_.shuffle(i).join(""),s.className="generated",!0},u=function(){document.getElementById("makePassword").addEventListener("click",a,!1)};return{init:u}};var DrivePass=DrivePass||{};DrivePass.Popup=function(){var t,e=document.getElementById("loading"),n=document.getElementById("status"),r=document.getElementById("un"),i=document.getElementById("pw"),s=document.getElementById("add"),o=document.getElementById("update"),a=document.getElementById("theInfo"),u=document.getElementById("currSite"),c=JSON.parse(localStorage.getItem("_full")),l=new DrivePass.GoogleSpreadsheet;l.init(DrivePass.Settings.gs_sheet_init);var f=function(t,e){var r=t||"",i=e||"";""!==r&&""!==i&&(n.textContent=i,n.className=r,n.style.display="block")},h=function(t){console.log(t),e.style.display="none",f("success","password found"),r.textContent=utils.encodeHTML(t.username),i.textContent=utils.encodeHTML(t.password),u.textContent=utils.encodeHTML(t.site),DrivePass.Browser.sendToPage({username:t.username,password:t.password}),s.classList.remove("show"),o.classList.add("show")},p=function(){e.style.display="none",f("error","password not found"),utils.toggle(a)},d=function(){s.addEventListener("click",function(){var e=document.getElementById("un").textContent,n=document.getElementById("pw").textContent,r=[t,e,n];l.add(r,function(t){t.success===!1?f("error",t.message):(f("success",t.message),DrivePass.ResetLocal().init())})},!1)},g=function(){o.addEventListener("click",function(){var t=u.textContent,e=v(t),n=document.getElementById("un").textContent,r=document.getElementById("pw").textContent,i=[t,n,r];l.update(e,i,function(t){t.success===!1?f("error",t.message):(f("success",t.message),DrivePass.ResetLocal().init())})},!1)},v=function(t){var e=c.sheetData;for(var n in e.feed.entry)if(e.feed.entry[n].gsx$site.$t===t)return e.feed.entry[n]},m=function(){t=DrivePass.Browser.activeTabUrl.replace("www.","");var e=DrivePass.DB({site:t}).get();0===e.length?p():h(e[0])},y=function(){localStorage.sheet_url&&""!==localStorage.sheet_url?(null===c?DrivePass.ResetLocal().init(function(){DrivePass.Browser.getActiveTab(m)}):DrivePass.Browser.getActiveTab(m),d(),g()):(f("error","no spreadsheet set in options"),chrome.tabs.create({url:"options.html"}))};return{init:y}};var DrivePass=DrivePass||{};DrivePass.ResetLocal=function(){var t=new DrivePass.GoogleSpreadsheet;
t.init(DrivePass.Settings.gs_sheet_init);var e=function(e){t.load(function(t){if(localStorage.setItem("_full",JSON.stringify(t)),t.success===!0){"undefined"!=typeof localStorage.taffy_tdb&&localStorage.removeItem("taffy_tdb");var n=DrivePass.Filters.createDBarray(t.sheetData);DrivePass.DB=TAFFY(n),DrivePass.DB.store("tdb"),"function"==typeof e&&e()}})};return{init:e}};var DrivePass=DrivePass||{};DrivePass.Router=function(){function t(t){this.methods=t,this.process()}return t.prototype.process=function(){this.methods.universal();var t=document.body.dataset.route;if("undefined"!=typeof t){var e=this.methods[t];"function"==typeof e&&e()}},t}();var DrivePass=DrivePass||{};DrivePass.Signal=function(){"use strict";var t={},e=-1,n=function(n,r){t[n]||(t[n]=[]);var i=(++e).toString();return t[n].push({token:i,func:r}),i},r=function(e,n){return t[e]?(setTimeout(function(){for(var r=t[e],i=r?r.length:0;i--;)r[i].func(e,n)},0),!0):!1},i=function(e){for(var n in t)if(t[n])for(var r=0,i=t[n].length;i>r;r++)if(t[n][r].token===e)return t[n].splice(r,1),e;return!1};return{broadcast:r,listen:n,off:i}}();var utils={toggle:function(t){t.classList.contains("show")?t.classList.remove("show"):t.classList.add("show")},toggler:function(t,e){var n=this,r=document.getElementById(e);document.getElementById(t).addEventListener("click",function(){n.toggle(r)},!1)},getHostname:function(t){var e=t||"",n=document.createElement("a");return""!==e?(n.href=e,n.hostname):(console.warn("url undefined"),!1)},encodeHTML:function(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/"/g,"&quot;")},addslashes:function(t){return(t+"").replace(/[\\"']/g,"\\$&").replace(/\u0000/g,"\\0")},getJSON:function(t,e,n){var r,i=new XMLHttpRequest,s=function(){console.log("")},o="function"==typeof e?e:s,a="function"==typeof n?n:s;i.open("GET",t,!1),i.onload=function(){i.status>=200&&i.status<400?(r=JSON.parse(i.responseText),o(r)):a()},i.onerror=function(){a()},i.send(null)}},DrivePass=DrivePass||{};DrivePass.ext=new DrivePass.Router({universal:function(){if(DrivePass.Settings=JSON.parse(localStorage.getItem("options"))||{},DrivePass.Settings.keeplocal=DrivePass.Settings.keeplocal||!0,DrivePass.Settings.route=document.body.dataset.route,DrivePass.Settings.gs_sheet_init={sheet_url:localStorage.getItem("sheet_url"),columns:["site","username","password"]},"undefined"!=typeof localStorage.taffy_tdb)DrivePass.DB=TAFFY().store("tdb");else if("undefined"!=typeof localStorage._full){var t=localStorage.getItem("_full");t=DrivePass.Filters.createDBarray(JSON.parse(t).sheetData),DrivePass.DB=TAFFY(t)}else DrivePass.ResetLocal().init()},popup:function(){var t=function(){utils.toggler("showGPoptions","gpOptions"),utils.toggler("showInfo","theInfo"),utils.toggler("show_symbols","hidden_symbols")},e=new DrivePass.Popup,n=new DrivePass.Generator;document.addEventListener("DOMContentLoaded",function(){this.bDone||(this.bDone=!0,n.init(),e.init(),t())})},chrome_options:function(){new DrivePass.Options}});