var utils={toggle:function(a){a.classList.contains("show")?a.classList.remove("show"):a.classList.add("show")},toggler:function(a,b){var c=this,d=document.getElementById(b);document.getElementById(a).addEventListener("click",function(){c.toggle(d)},!1)},getHostname:function(a){var b=a||"",c=document.createElement("a");return""!==b?(c.href=b,c.hostname):(console.warn("url undefined"),!1)}},DrivePass=DrivePass||{};DrivePass.GoogleSpreadsheet=function(){var a,b=chrome.extension.getBackgroundPage(),c={},d=function(a){var b=JSON.parse(a),d=0,e={},f=b.feed.entry,g=c.columns;for(var h in f){e[d]={};for(var i=0;i<g.length;i++){var j="gsx$"+g[i];e[d][g[i]]=f[h][j].$t}d++}return e},e=function(b,e){return 200!==e.status?(a={success:!1,message:e.status+": Connection Failed"},console.warn(e)):(a={success:!0,message:"spreadsheet successfully loaded"},a.sheetData=d(b)),null!==c.cb&&c.cb(a),a},f=function(a){c.cb="function"==typeof a?a:null;var d={headers:{"GData-Version":"3.0"},parameters:{alt:"json",showfolders:"true"}};b.oauth.sendSignedRequest(c.jsonListUrl,e,d)},g=function(a,d){c.cb="function"==typeof d?d:null;var e={method:"POST",headers:{"GData-Version":"3.0","Content-Type":"application/atom+xml"},body:h(a)};b.oauth.sendSignedRequest(c.jsonListUrl,i,e)},h=function(a){for(var b='<entry xmlns="http://www.w3.org/2005/Atom" xmlns:gsx="http://schemas.google.com/spreadsheets/2006/extended">\n',d=c.columns,e=0;e<d.length;e++)b+="<gsx:"+d[e]+">"+a[e]+"</gsx:"+d[e]+">\n";return b+="</entry>"},i=function(b,d){return 201!==d.status?(a={success:!1,message:d.status+": error saving"},console.warn(d)):a={success:!0,message:"saved successfully"},null!==c.cb&&c.cb(a),a},j=function(a){if(c=a||{},"string"!=typeof c.sheet_url||"object"!=typeof c.columns)throw new Error("Missing sheet_url or columns from init options");var b,d,e=c.sheet_url;if(e.match(/http(s)*:/)){b=e;try{d=b.match(/key=(.*?)(&|#)/)[1]}catch(f){d=b.match(/(cells|list)\/(.*?)\//)[2]}}else d=e;return c.jsonListUrl="https://spreadsheets.google.com/feeds/list/"+d+"/od6/private/full",c.jsonCellsUrl="https://spreadsheets.google.com/feeds/cells/"+d+"/od6/private/basic",this};return{init:j,load:f,add:g}};var DrivePass=DrivePass||{};DrivePass.Generator=function(){var a=document.getElementById("uppercase"),b=document.getElementById("lowercase"),c=document.getElementById("numbers"),d=document.getElementById("show_symbols"),e=document.getElementById("symbols"),f=document.getElementById("pw"),g=function(){var f="",g=0,h="",i=document.getElementById("digits").value||15;if(2>i&&(i=7),[a,b,c].forEach(function(a){if(a.checked===!0){h+=a.value;var b=a.value.length;f+=a.value.charAt(Math.floor(Math.random()*b)),g++}}),d.checked===!0){h+=e.value;var j=e.value.length;f+=e.value.charAt(Math.floor(Math.random()*j)),g++}return[i,h,f,g]},h=function(a){a.preventDefault();for(var b=g(),c=b[0]-b[3],d=b[1],e="",h=0,i=d.length;c>h;++h)e+=d.charAt(Math.floor(Math.random()*i));e+=b[2],f.textContent=e,f.className="generated"},i=function(){document.getElementById("makePassword").addEventListener("click",h,!1)};return{init:i}};var DrivePass=DrivePass||{};DrivePass.Popup=function(){var a,b=document.getElementById("loading"),c=document.getElementById("status"),d=document.getElementById("un"),e=document.getElementById("pw"),f=document.getElementById("add"),g=document.getElementById("theInfo"),h=new DrivePass.GoogleSpreadsheet,i=function(a,b){chrome.tabs.getSelected(null,function(c){chrome.tabs.sendMessage(c.id,{password:b,username:a},function(a){console.log(a.dom)})})},j=function(a,b){var c=a||{};if(Object.keys(c).length){for(var d in c)if(-1!==b.indexOf(c[d].site)){var e=[];return e.push(c[d].username,c[d].password),e}}else console.warn("findPW: data not an object")},k=function(a,b){var d=a||"",e=b||"";""!==d&&""!==e&&(c.textContent=e,c.className=d,c.style.display="block")},l=function(a){b.style.display="none",k("success","password found"),d.textContent=a[0],e.textContent=a[1],i(a[0],a[1]),f.textContent="update"},m=function(){b.style.display="none",k("error","password not found"),utils.toggle(g)},n=function(){f.addEventListener("click",function(){var b=document.getElementById("un").textContent,c=document.getElementById("pw").textContent,d=[a,b,c];h.add(d,function(a){a.success===!1?k("error",a.message):k("success",a.message)})},!1)},o=function(){chrome.tabs.query({active:!0,lastFocusedWindow:!0},function(b){var c=b[0];a=utils.getHostname(c.url),h.init({sheet_url:localStorage.sheet_url,columns:["site","username","password"]}),h.load(function(b){var c=j(b.sheetData,a);"undefined"==typeof c?m():l(c)})}),n()};return{init:o}},function(){var a=function(){utils.toggler("showGPoptions","gpOptions"),utils.toggler("showInfo","theInfo"),utils.toggler("show_symbols","hidden_symbols")},b=new DrivePass.Popup,c=new DrivePass.Generator;document.addEventListener("DOMContentLoaded",function(){this.bDone||(this.bDone=!0,c.init(),b.init(),a())})}();